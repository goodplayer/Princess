{{define "user_bar"}}

{{with $result := .}}
{{with $context := $result.CONTEXT}}
{{with $SITE := $result.SITE}}

{{with $isLogin := is_login $context}}
{{if eq $isLogin "true"}}
<!-- do nothing -->
{{else}}
<!-- 登录Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-signin" id="form-login" method="post" action="/login" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">登录</h4>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" placeholder="用户名" name="j_username">
                    <br/>
                    <input type="password" class="form-control" placeholder="密码" name="j_password">
                    <!--<button class="btn btn-large btn-primary" id="loginbutton" type="button" data-loading-text="登录中..." data-complete-text="等待跳转..." onclick="loginCheck()" >登录</button>-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">登录</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- 注册Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-signin" id="registerModal-form-login" method="post" action="/register" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">注册</h4>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" placeholder="用户名" name="j_username">
                    <br/>
                    <input type="password" class="form-control" placeholder="密码(8位以上)" name="j_password">
                    <br/>
                    <input type="email" class="form-control" placeholder="邮箱" name="j_email">
                    <br/>
                    <input type="text" class="form-control" placeholder="昵称" name="j_nickname">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">注册</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div><!-- /.modal -->
{{end}}
{{end}}

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="/" class="navbar-brand">{{$SITE.default_site_name}}</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="about">About</a></li>
                <li><a href="#">Popup</a></li>
            </ul>

            {{with $isLogin := is_login $context}}
            {{if eq $isLogin "true"}}
            {{with $user := user $context}}
            <ul class="nav navbar-nav pull-right">
                <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">欢迎你，{{ user_nickname $context }}</a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li><a href="/new_post">发表文章</a></li>
                        <hr/>
                        <li><a href="/logout">登出</a></li>
                    </ul>
                </li>
            </ul>
            {{end}}
            {{else}}
            <ul class="nav navbar-nav pull-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#myModal">登录</a>
                </li>
            </ul>
            <ul class="nav navbar-nav pull-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#registerModal">注册</a>
                </li>
            </ul>
            {{end}}
            {{end}}
        </div>
    </div>
</nav>
{{end}}
{{end}}
{{end}}

{{end}}
